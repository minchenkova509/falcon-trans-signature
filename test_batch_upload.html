<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</h1>
    
    <div class="test-section">
        <h3>1. –¢–µ—Å—Ç API –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</h3>
        <button onclick="testCoordinates()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</button>
        <div id="coordinatesResult"></div>
    </div>
    
    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞</h3>
        <input type="file" id="testFile" accept=".pdf" />
        <button onclick="testFileUpload()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
        <div id="uploadResult"></div>
    </div>
    
    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏</h3>
        <button onclick="testBatchProcessing()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–∫–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É</button>
        <div id="batchResult"></div>
    </div>

    <script>
        // –¢–µ—Å—Ç API –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        async function testCoordinates() {
            const resultDiv = document.getElementById('coordinatesResult');
            try {
                const response = await fetch('/api/coordinates?seal_type=falcon');
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = `<div class="success">
                        ‚úÖ API –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç<br>
                        X: ${data.coordinates.x.toFixed(2)} pt<br>
                        Y: ${data.coordinates.y.toFixed(2)} pt<br>
                        Width: ${data.coordinates.width.toFixed(2)} pt<br>
                        Height: ${data.coordinates.height.toFixed(2)} pt
                    </div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ API: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}</div>`;
            }
        }

        // –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        function testFileUpload() {
            const fileInput = document.getElementById('testFile');
            const resultDiv = document.getElementById('uploadResult');
            
            if (fileInput.files.length === 0) {
                resultDiv.innerHTML = '<div class="error">‚ùå –§–∞–π–ª –Ω–µ –≤—ã–±—Ä–∞–Ω</div>';
                return;
            }
            
            const file = fileInput.files[0];
            if (file.type !== 'application/pdf') {
                resultDiv.innerHTML = '<div class="error">‚ùå –í—ã–±—Ä–∞–Ω –Ω–µ PDF —Ñ–∞–π–ª</div>';
                return;
            }
            
            resultDiv.innerHTML = `<div class="success">
                ‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω<br>
                –ò–º—è: ${file.name}<br>
                –†–∞–∑–º–µ—Ä: ${(file.size / 1024).toFixed(2)} KB<br>
                –¢–∏–ø: ${file.type}
            </div>`;
        }

        // –¢–µ—Å—Ç –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
        async function testBatchProcessing() {
            const fileInput = document.getElementById('testFile');
            const resultDiv = document.getElementById('batchResult');
            
            if (fileInput.files.length === 0) {
                resultDiv.innerHTML = '<div class="error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</div>';
                return;
            }
            
            const file = fileInput.files[0];
            
            try {
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ñ–∞–π–ª –≤ base64
                const base64 = await fileToBase64(file);
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                const coordsResponse = await fetch('/api/coordinates?seal_type=falcon');
                const coordsData = await coordsResponse.json();
                
                const requestData = {
                    files: [{
                        filename: file.name,
                        pdfData: base64
                    }],
                    seal_type: 'falcon',
                    add_signature: false,
                    coordinates: coordsData.coordinates
                };
                
                resultDiv.innerHTML = '<div>üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª...</div>';
                
                const response = await fetch('/api/batch-process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `<div class="success">
                        ‚úÖ –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç<br>
                        –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${result.processed_files}/${result.total_files} —Ñ–∞–π–ª–æ–≤<br>
                        –ü–µ—Ä–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${result.results[0].success ? '–£—Å–ø–µ—à–Ω–æ' : '–û—à–∏–±–∫–∞'}
                    </div>`;
                } else {
                    resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: ${result.error}</div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞ –≤ base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html> 