# üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–æ—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü

## üîç **–ü—Ä–æ–±–ª–µ–º–∞**

**–°–∏–º–ø—Ç–æ–º**: –ü–µ—á–∞—Ç—å "—É–ø–æ–ª–∑–∞–ª–∞" –≤–≤–µ—Ä—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å `/Rotate`

**–ü—Ä–∏—á–∏–Ω–∞**: –î–≤–æ–π–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç —Ä–æ—Ç–∞—Ü–∏–∏ - —Ä–µ–Ω–¥–µ—Ä–µ—Ä –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤–∏–∑—É–∞–ª—å–Ω–æ, –∞ –º—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–ª–∏ –æ–≤–µ—Ä–ª–µ–π, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é.

## üîß **–†–µ—à–µ–Ω–∏–µ**

### **–°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (–ø—Ä–æ–±–ª–µ–º–Ω—ã–π):**
```python
# –°–æ–∑–¥–∞–µ–º –æ–≤–µ—Ä–ª–µ–π
overlay_page = make_overlay(pw, ph, items)

# –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π (–î–í–û–ô–ù–û–ô –≠–§–§–ï–ö–¢!)
if rotation:
    overlay_page.rotate(rotation)

page.merge_page(overlay_page)
```

### **–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):**
```python
def normalize_coords_for_page(page, x, y, w, h):
    """–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–¥ —É–≥–æ–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–µ–∑ –ø–æ–≤–æ—Ä–æ—Ç–∞ –æ–≤–µ—Ä–ª–µ—è"""
    pw, ph = float(page.mediabox.width), float(page.mediabox.height)
    rot = int(page.get("/Rotate", 0)) % 360

    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø–æ–¥ —É–≥–æ–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    if rot == 0:
        x2, y2 = x, y
    elif rot == 90:
        x2 = y
        y2 = pw - (x + w)
    elif rot == 180:
        x2 = pw - (x + w)
        y2 = ph - (y + h)
    elif rot == 270:
        x2 = ph - (y + h)
        y2 = x

    # –£—á—ë—Ç CropBox-—Å–º–µ—â–µ–Ω–∏—è
    crop = page.cropbox
    off_x = float(crop.lower_left[0])
    off_y = float(crop.lower_left[1])
    x2 += off_x
    y2 += off_y

    return x2, y2, w, h

# –ù–ï –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π - –≤—Å—è –º–∞–≥–∏—è –≤ –ø–µ—Ä–µ—Å—á–µ—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
overlay_page = make_overlay(pw, ph, normalized_items)
page.merge_page(overlay_page)
```

## üìê **–§–æ—Ä–º—É–ª—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç**

### **–î–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ 90¬∞:**
```
(x, y) ‚Üí (y, pw - (x + w))
```

### **–î–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ 180¬∞:**
```
(x, y) ‚Üí (pw - (x + w), ph - (y + h))
```

### **–î–ª—è —Ä–æ—Ç–∞—Ü–∏–∏ 270¬∞:**
```
(x, y) ‚Üí (ph - (y + h), x)
```

## üîç **–û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:

```python
print(f"page: {i}, rot: {int(page.get('/Rotate', 0))}, "
      f"mediabox: {page.mediabox}, cropbox: {page.cropbox}, "
      f"in: ({x:.2f}, {y:.2f}, {w:.2f}, {h:.2f}), "
      f"norm: ({nx:.2f}, {ny:.2f}, {nw:.2f}, {nh:.2f})")
```

## ‚úÖ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚ùå –î–≤–æ–π–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç —Ä–æ—Ç–∞—Ü–∏–∏
- ‚ùå –ü–µ—á–∞—Ç—å —Å–º–µ—â–∞–ª–∞—Å—å –≤–≤–µ—Ä—Ö
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ –ü–µ—á–∞—Ç—å –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –Ω—É–∂–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —É–≥–ª–æ–≤ —Ä–æ—Ç–∞—Ü–∏–∏
- ‚úÖ –£—á–µ—Ç CropBox —Å–º–µ—â–µ–Ω–∏–π

## üöÄ **–°—Ç–∞—Ç—É—Å**

**–†–æ—Ç–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:**

- ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω –¥–≤–æ–π–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç** —Ä–æ—Ç–∞—Ü–∏–∏
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã** –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ **–û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —É–≥–ª–æ–≤** (0¬∞, 90¬∞, 180¬∞, 270¬∞)

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéØ

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ: 12 –∞–≤–≥—É—Å—Ç–∞ 2025*
*–í–µ—Ä—Å–∏—è: 1.0.4 (Rotation Fixed)* 