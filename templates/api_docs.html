<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Документация - ФАЛКОН-ТРАНС</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <style>
        .api-endpoint {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 5px 5px 0;
        }
        .method {
            font-weight: bold;
            color: #007bff;
        }
        .endpoint-url {
            font-family: monospace;
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .response-example {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row min-vh-100">
            <!-- Левая панель с навигацией -->
            <div class="col-md-3 bg-primary text-white p-4">
                <div class="text-center mb-4">
                    <i class="fas fa-truck fa-3x mb-3"></i>
                    <h2>ФАЛКОН-ТРАНС</h2>
                    <h5>API Документация</h5>
                </div>
                
                <nav class="nav flex-column">
                    <a class="nav-link text-white" href="/">
                        <i class="fas fa-home me-2"></i>Главная
                    </a>
                    <a class="nav-link text-white" href="/editor">
                        <i class="fas fa-edit me-2"></i>Редактор
                    </a>
                    <a class="nav-link text-white active" href="/api-docs">
                        <i class="fas fa-book me-2"></i>API Документация
                    </a>
                </nav>
            </div>
            
            <!-- Основной контент -->
            <div class="col-md-9 p-4">
                <h1 class="mb-4">
                    <i class="fas fa-book text-primary me-2"></i>
                    API Документация
                </h1>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Базовый URL:</strong> <code>https://your-domain.com</code>
                </div>
                
                <!-- Эндпоинты -->
                <section class="mb-5">
                    <h2 class="mb-3">Эндпоинты</h2>
                    
                    <!-- Получение доступных печатей -->
                    <div class="api-endpoint">
                        <h4>
                            <span class="method">GET</span>
                            <span class="endpoint-url">/api/seals</span>
                        </h4>
                        <p class="text-muted">Возвращает список доступных печатей и их типов.</p>
                        
                        <h6>Ответ:</h6>
                        <div class="response-example">
{
  "seals": [
    {
      "id": "falcon",
      "name": "ФАЛКОН-ТРАНС (ООО)",
      "type": "company",
      "description": "Официальная печать компании ФАЛКОН-ТРАНС",
      "image_url": "/static/images/falcon_seal.png"
    },
    {
      "id": "ip",
      "name": "ИП Заикина",
      "type": "individual",
      "description": "Печать индивидуального предпринимателя",
      "image_url": "/static/images/ip_seal.png"
    }
  ]
}
                        </div>
                    </div>
                    
                    <!-- Получение статистики -->
                    <div class="api-endpoint">
                        <h4>
                            <span class="method">GET</span>
                            <span class="endpoint-url">/api/stats</span>
                        </h4>
                        <p class="text-muted">Возвращает статистику использования приложения.</p>
                        
                        <h6>Ответ:</h6>
                        <div class="response-example">
{
  "total_processed_files": 42,
  "max_file_size_mb": 16,
  "available_seals": 2,
  "service_status": "active",
  "version": "1.0.0"
}
                        </div>
                    </div>
                    
                    <!-- Загрузка файла -->
                    <div class="api-endpoint">
                        <h4>
                            <span class="method">POST</span>
                            <span class="endpoint-url">/upload</span>
                        </h4>
                        <p class="text-muted">Загружает PDF файл и добавляет подпись/печать.</p>
                        
                        <h6>Параметры:</h6>
                        <ul>
                            <li><code>file</code> - PDF файл (обязательно)</li>
                            <li><code>seal_type</code> - тип печати: "falcon" или "ip" (по умолчанию: "falcon")</li>
                            <li><code>add_signature</code> - добавить подпись: "true" или "false" (по умолчанию: "false")</li>
                        </ul>
                        
                        <h6>Ответ:</h6>
                        <div class="response-example">
{
  "success": true,
  "filename": "document_с_подписью.pdf",
  "message": "Подпись успешно добавлена!"
}
                        </div>
                    </div>
                    
                    <!-- Сохранение документа -->
                    <div class="api-endpoint">
                        <h4>
                            <span class="method">POST</span>
                            <span class="endpoint-url">/save-document</span>
                        </h4>
                        <p class="text-muted">Сохраняет документ с наложенными печатями (для редактора).</p>
                        
                        <h6>Тело запроса:</h6>
                        <div class="response-example">
{
  "pdfData": "base64_encoded_pdf_data",
  "seals": [
    {
      "pageIndex": 0,
      "xPt": 100,
      "yPt": 200,
      "wPt": 176,
      "hPt": 136,
      "opacity": 1.0,
      "type": "falcon"
    }
  ]
}
                        </div>
                        
                        <h6>Ответ:</h6>
                        <div class="response-example">
{
  "success": true,
  "pdfData": "data:application/pdf;base64,encoded_result",
  "filename": "document_with_seals_1234567890.pdf"
}
                        </div>
                    </div>
                    
                    <!-- Скачивание файла -->
                    <div class="api-endpoint">
                        <h4>
                            <span class="method">GET</span>
                            <span class="endpoint-url">/download/&lt;filename&gt;</span>
                        </h4>
                        <p class="text-muted">Скачивает обработанный PDF файл.</p>
                        
                        <h6>Параметры:</h6>
                        <ul>
                            <li><code>filename</code> - имя файла для скачивания</li>
                        </ul>
                    </div>
                    
                    <!-- Проверка здоровья -->
                    <div class="api-endpoint">
                        <h4>
                            <span class="method">GET</span>
                            <span class="endpoint-url">/health</span>
                        </h4>
                        <p class="text-muted">Проверка состояния сервиса.</p>
                        
                        <h6>Ответ:</h6>
                        <div class="response-example">
{
  "status": "healthy"
}
                        </div>
                    </div>
                    
                    <!-- Ping -->
                    <div class="api-endpoint">
                        <h4>
                            <span class="method">GET</span>
                            <span class="endpoint-url">/ping</span>
                        </h4>
                        <p class="text-muted">Эндпоинт для Keep Alive.</p>
                        
                        <h6>Ответ:</h6>
                        <div class="response-example">
{
  "status": "pong",
  "timestamp": "2024-01-15T10:30:00.000Z",
  "service": "falcon-trans-signature"
}
                        </div>
                    </div>
                </section>
                
                <!-- Коды ошибок -->
                <section class="mb-5">
                    <h2 class="mb-3">Коды ошибок</h2>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Код</th>
                                    <th>Описание</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>400</code></td>
                                    <td>Неверный запрос (отсутствует файл, неверный формат)</td>
                                </tr>
                                <tr>
                                    <td><code>413</code></td>
                                    <td>Файл слишком большой (максимум 16 МБ)</td>
                                </tr>
                                <tr>
                                    <td><code>404</code></td>
                                    <td>Страница не найдена</td>
                                </tr>
                                <tr>
                                    <td><code>500</code></td>
                                    <td>Внутренняя ошибка сервера</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Примеры использования -->
                <section class="mb-5">
                    <h2 class="mb-3">Примеры использования</h2>
                    
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">JavaScript (Fetch API)</h5>
                        </div>
                        <div class="card-body">
                            <pre><code>// Загрузка файла
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('seal_type', 'falcon');
formData.append('add_signature', 'true');

fetch('/upload', {
    method: 'POST',
    body: formData
})
.then(response => response.json())
.then(data => {
    if (data.success) {
        window.location.href = `/download/${data.filename}`;
    }
});

// Получение статистики
fetch('/api/stats')
.then(response => response.json())
.then(data => {
    console.log('Обработано файлов:', data.total_processed_files);
});</code></pre>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">cURL</h5>
                        </div>
                        <div class="card-body">
                            <pre><code># Загрузка файла
curl -X POST \
  -F "file=@document.pdf" \
  -F "seal_type=falcon" \
  -F "add_signature=true" \
  http://localhost:5000/upload

# Получение статистики
curl http://localhost:5000/api/stats

# Проверка здоровья
curl http://localhost:5000/health</code></pre>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html> 