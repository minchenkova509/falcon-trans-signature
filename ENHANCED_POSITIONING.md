# üöÄ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—á–∞—Ç–∏ - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã **–û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π**

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —É–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—á–∞—Ç–∏ –∏ –ø–æ–¥–ø–∏—Å–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–º–µ—â–µ–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

## ‚öôÔ∏è **–ù–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã**

```python
# –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Å–º–µ—â–µ–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—á–∞—Ç–∏
SHIFT_MM = 60       # –ø–æ–¥–Ω—è—Ç—å –Ω–∞ 6 —Å–º (–æ–ø—É—Å—Ç–∏–ª–∏ –Ω–∞ 1 —Å–º –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏)
SCALE = 2.64        # —É–≤–µ–ª–∏—á–∏—Ç—å –≤ 2.64 —Ä–∞–∑–∞ (–¥–æ–±–∞–≤–∏–ª–∏ 2 —Å–º –∫ —Ä–∞–∑–º–µ—Ä–∞–º)
```

## üìè **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º**

### **–ë–∞–∑–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã (–≤ –º–º):**
- **–ü–µ—á–∞—Ç—å**: 17.6 √ó 13.6 –º–º
- **–ü–æ–¥–ø–∏—Å—å**: 53 √ó 28 –º–º
- **–û—Ç—Å—Ç—É–ø—ã**: 17.6 –º–º –æ—Ç –∫—Ä–∞–µ–≤

### **–ù–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã (—Å —É—á–µ—Ç–æ–º SCALE = 2.64):**
- **–ü–µ—á–∞—Ç—å**: 46.4 √ó 35.9 –º–º (√ó2.64)
- **–ü–æ–¥–ø–∏—Å—å**: 139.9 √ó 73.9 –º–º (√ó2.64)
- **–û—Ç—Å—Ç—É–ø—ã**: –æ—Å—Ç–∞—é—Ç—Å—è 17.6 –º–º

### **–ù–æ–≤–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å —É—á–µ—Ç–æ–º SHIFT_MM = 60):**
- **Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞**: 17.6 –º–º ‚Üí 77.6 –º–º (+60 –º–º)
- **X –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞**: –æ—Å—Ç–∞–µ—Ç—Å—è 17.6 –º–º

## üîß **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ**

### **–§—É–Ω–∫—Ü–∏—è get_standard_seal_coordinates:**

```python
def get_standard_seal_coordinates(page_width_pt, page_height_pt, seal_type="falcon", add_signature=False):
    # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö
    SEAL_WIDTH_MM = 17.6
    SEAL_HEIGHT_MM = 13.6
    SIGNATURE_WIDTH_MM = 53
    SIGNATURE_HEIGHT_MM = 28
    GAP_MM = 6
    MARGIN_LEFT_MM = 17.6
    MARGIN_BOTTOM_MM = 17.6
    
    if add_signature:
        # –ü–æ–¥–ø–∏—Å—å —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        signature = {
            'x': mm(MARGIN_LEFT_MM),
            'y': mm(MARGIN_BOTTOM_MM + SHIFT_MM),  # +100 –º–º
            'w': mm(SIGNATURE_WIDTH_MM * SCALE),    # √ó2
            'h': mm(SIGNATURE_HEIGHT_MM * SCALE)    # √ó2
        }
        
        # –ü–µ—á–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        seal = {
            'x': signature['x'] + signature['w'] + mm(GAP_MM),
            'y': signature['y'],
            'w': mm(SEAL_WIDTH_MM * SCALE),         # √ó2
            'h': mm(SEAL_HEIGHT_MM * SCALE)         # √ó2
        }
    else:
        # –¢–æ–ª—å–∫–æ –ø–µ—á–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
        return {
            'x': mm(MARGIN_LEFT_MM),
            'y': mm(MARGIN_BOTTOM_MM + SHIFT_MM),   # +100 –º–º
            'width': mm(SEAL_WIDTH_MM * SCALE),     # √ó2
            'height': mm(SEAL_HEIGHT_MM * SCALE)    # √ó2
        }
```

### **–ó–∞—â–∏—Ç–∞ –æ—Ç –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã:**

```python
def merge_on_page(page, items):
    pw, ph = float(page.mediabox.width), float(page.mediabox.height)
    
    for i, it in enumerate(items):
        nx, ny, nw, nh = normalize_rect_visual_to_user(page, it["x"], it["y"], it["w"], it["h"])
        
        # –ü–æ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞: –Ω–µ –≤—ã–π—Ç–∏ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        nx = max(0, min(nx, pw - nw))
        ny = max(0, min(ny, ph - nh))
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        print(f"rot= {int(page.get('/Rotate', 0))}, "
              f"in= ({it['x']:.2f}, {it['y']:.2f}, {it['w']:.2f}, {it['h']:.2f}), "
              f"norm= ({nx:.2f}, {ny:.2f}, {nw:.2f}, {nh:.2f}), "
              f"mb= ({pw:.2f}, {ph:.2f})")
```

## üìä **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã API**

### **–¢–æ–ª—å–∫–æ –ø–µ—á–∞—Ç—å (falcon):**
```json
{
    "coordinates": {
        "x": 49.89,      // 17.6 –º–º
        "y": 219.97,     // 77.6 –º–º (–±—ã–ª–æ 49.89)
        "width": 131.71, // 46.4 –º–º (–±—ã–ª–æ 49.89)
        "height": 101.78 // 35.9 –º–º (–±—ã–ª–æ 37.55)
    }
}
```

### **–ü–µ—á–∞—Ç—å + –ø–æ–¥–ø–∏—Å—å (falcon):**
```json
{
    "coordinates": {
        "x": 49.89,      // 17.6 –º–º
        "y": 219.97,     // 77.6 –º–º
        "width": 545.34, // 192.4 –º–º (–ø–æ–¥–ø–∏—Å—å + –ø–µ—á–∞—Ç—å)
        "height": 209.54 // 73.9 –º–º (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞)
    }
}
```

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**

### **1. –ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–º–µ—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `SHIFT_MM`
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –º–∞—Å—à—Ç–∞–± —á–µ—Ä–µ–∑ `SCALE`
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### **2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∏ CropBox
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –≤—Å–µ—Ö —É–≥–ª–æ–≤ –ø–æ–≤–æ—Ä–æ—Ç–∞

### **3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –ü—Ä–µ–¥–∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ PNG –±–∞–π—Ç—ã
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è

### **4. –û—Ç–ª–∞–¥–∫–∞**
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π
- –ö–æ–Ω—Ç—Ä–æ–ª—å –≥—Ä–∞–Ω–∏—Ü —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## üîç **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**
```bash
# –¢–æ–ª—å–∫–æ –ø–µ—á–∞—Ç—å
curl "http://localhost:8082/api/coordinates?seal_type=falcon"

# –ü–µ—á–∞—Ç—å + –ø–æ–¥–ø–∏—Å—å
curl "http://localhost:8082/api/coordinates?seal_type=falcon&add_signature=true"
```

### **–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- –ü–µ—á–∞—Ç—å –ø–æ–¥–Ω—è—Ç–∞ –Ω–∞ 6 —Å–º (60 –º–º) - –æ–ø—É—Å—Ç–∏–ª–∏ –Ω–∞ 1 —Å–º –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
- –†–∞–∑–º–µ—Ä—ã —É–≤–µ–ª–∏—á–µ–Ω—ã –≤ 2.64 —Ä–∞–∑–∞ - –¥–æ–±–∞–≤–∏–ª–∏ 2 —Å–º –∫ —Ä–∞–∑–º–µ—Ä–∞–º
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
- –†–∞–±–æ—Ç–∞ —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∏ CropBox

## ‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**

**–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞:**

- ‚úÖ **–°–º–µ—â–µ–Ω–∏–µ**: +60 –º–º –ø–æ Y (–ø–æ–¥—ä–µ–º –Ω–∞ 6 —Å–º)
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: √ó2.64 –¥–ª—è –≤—Å–µ—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–æ—Ç–∞—Ü–∏–µ–π –∏ CropBox
- ‚úÖ **–û—Ç–ª–∞–¥–∫–∞**: –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å –Ω–æ–≤—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏!** üöÄ

---

*–í–µ—Ä—Å–∏—è: 1.0.10 (Fine-tuned Positioning)*
*–î–∞—Ç–∞: 12 –∞–≤–≥—É—Å—Ç–∞ 2025* 